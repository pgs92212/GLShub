<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLSHub - Plataforma de Jogos HTML</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;600;700&display=swap');
        
        * {
            cursor: url('https://cur.cursors-4u.net/cursors/cur-2/cur116.cur'), auto;
        }
        
        a, button, input[type="submit"], .clickable, [onclick] {
            cursor: url('https://cur.cursors-4u.net/cursors/cur-1/cur45.cur'), pointer;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #E0F7FA 30%, #B2EBF2 60%, #4FC3F7 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 50% 100%, rgba(255,255,255,0.3) 0%, transparent 60%),
                radial-gradient(ellipse 60% 40% at 20% 80%, rgba(144,238,144,0.2) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 70%, rgba(135,206,250,0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Bubbles Animation */
        .bubble {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.1));
            box-shadow: 
                inset 0 0 20px rgba(255,255,255,0.5),
                0 0 10px rgba(255,255,255,0.3);
            animation: float 15s infinite ease-in-out;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-100px) rotate(180deg); opacity: 1; }
        }

        /* Scrollbar Aero */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: linear-gradient(90deg, #e0e0e0, #f5f5f5, #e0e0e0);
            border-radius: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #7dd3fc, #38bdf8, #0ea5e9);
            border-radius: 6px;
            border: 2px solid rgba(255,255,255,0.5);
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.5);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #38bdf8, #0ea5e9, #0284c7);
        }

        /* Glass Card Effect */
        .glass-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.6) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.8);
            box-shadow: 
                0 8px 32px rgba(0, 100, 150, 0.15),
                inset 0 2px 0 rgba(255,255,255,0.8),
                inset 0 -2px 0 rgba(0,0,0,0.05);
            border-radius: 12px;
        }

        .glass-card-dark {
            background: linear-gradient(135deg, rgba(255,255,255,0.7) 0%, rgba(240,248,255,0.5) 100%);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 
                0 8px 32px rgba(0, 100, 150, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.9);
        }

        /* Glossy Button */
        .glossy-btn {
            background: linear-gradient(180deg, #7dd3fc 0%, #38bdf8 50%, #0ea5e9 100%);
            border: 1px solid #0284c7;
            box-shadow: 
                0 4px 15px rgba(14, 165, 233, 0.4),
                inset 0 2px 0 rgba(255,255,255,0.4),
                inset 0 -2px 0 rgba(0,0,0,0.1);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }

        .glossy-btn:hover {
            background: linear-gradient(180deg, #bae6fd 0%, #7dd3fc 50%, #38bdf8 100%);
            box-shadow: 
                0 6px 20px rgba(14, 165, 233, 0.5),
                inset 0 2px 0 rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        .glossy-btn-green {
            background: linear-gradient(180deg, #86efac 0%, #4ade80 50%, #22c55e 100%);
            border: 1px solid #16a34a;
            box-shadow: 
                0 4px 15px rgba(34, 197, 94, 0.4),
                inset 0 2px 0 rgba(255,255,255,0.4),
                inset 0 -2px 0 rgba(0,0,0,0.1);
        }

        .glossy-btn-green:hover {
            background: linear-gradient(180deg, #bbf7d0 0%, #86efac 50%, #4ade80 100%);
            box-shadow: 
                0 6px 20px rgba(34, 197, 94, 0.5),
                inset 0 2px 0 rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        /* Navbar Aero */
        .navbar-aero {
            background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(230,245,255,0.9) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.8);
            box-shadow: 
                0 4px 20px rgba(0,100,150,0.1),
                inset 0 -1px 0 rgba(0,0,0,0.05),
                inset 0 1px 0 rgba(255,255,255,1);
        }

        /* Game Card Hover */
        .game-card {
            transition: all 0.3s ease;
        }

        .game-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(0,100,150,0.25),
                inset 0 2px 0 rgba(255,255,255,0.9);
        }

        /* Input Aero Style */
        .input-aero {
            background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
            border: 1px solid #b0c4de;
            box-shadow: 
                inset 0 2px 4px rgba(0,0,0,0.08),
                0 1px 0 rgba(255,255,255,0.8);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .input-aero:focus {
            border-color: #38bdf8;
            box-shadow: 
                inset 0 2px 4px rgba(0,0,0,0.08),
                0 0 0 3px rgba(56,189,248,0.3),
                0 1px 0 rgba(255,255,255,0.8);
            outline: none;
        }

        /* Modal Aero */
        .modal-aero {
            background: linear-gradient(180deg, rgba(255,255,255,0.98) 0%, rgba(240,248,255,0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.9);
            box-shadow: 
                0 25px 50px rgba(0,80,120,0.3),
                inset 0 2px 0 rgba(255,255,255,1);
            border-radius: 16px;
        }

        /* Fire Animation */
        @keyframes fireGlow {
            0%, 100% { 
                box-shadow: 
                    0 0 20px #ff6600,
                    0 0 40px #ff4500,
                    0 0 60px #ff3300,
                    0 0 80px #ff0000,
                    inset 0 0 20px rgba(255, 100, 0, 0.3);
            }
            50% { 
                box-shadow: 
                    0 0 30px #ff8800,
                    0 0 50px #ff6600,
                    0 0 70px #ff4500,
                    0 0 90px #ff2200,
                    inset 0 0 30px rgba(255, 100, 0, 0.5);
            }
        }

        @keyframes fireFlicker {
            0%, 100% { opacity: 1; transform: scale(1); }
            25% { opacity: 0.9; transform: scale(1.02); }
            50% { opacity: 1; transform: scale(0.98); }
            75% { opacity: 0.95; transform: scale(1.01); }
        }

        .on-fire {
            animation: fireGlow 1.5s ease-in-out infinite, fireFlicker 0.5s ease-in-out infinite;
            border: 3px solid #ff6600 !important;
            position: relative;
        }

        .on-fire::before {
            content: 'üî•';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            z-index: 20;
            animation: fireFlicker 0.3s ease-in-out infinite;
            filter: drop-shadow(0 0 10px #ff6600);
        }

        .on-fire::after {
            content: 'üî• EM DESTAQUE üî•';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #ff6600, #ff4500, #ff0000);
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 20px;
            white-space: nowrap;
            z-index: 20;
            box-shadow: 0 4px 15px rgba(255, 100, 0, 0.5);
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .fire-btn {
            background: linear-gradient(180deg, #ffcc00 0%, #ff8800 50%, #ff4400 100%);
            border: 1px solid #ff6600;
            box-shadow: 
                0 4px 15px rgba(255, 100, 0, 0.4),
                inset 0 2px 0 rgba(255,255,255,0.4),
                inset 0 -2px 0 rgba(0,0,0,0.1);
        }

        .fire-btn:hover {
            background: linear-gradient(180deg, #ffdd44 0%, #ffaa00 50%, #ff6600 100%);
            box-shadow: 
                0 6px 20px rgba(255, 100, 0, 0.6),
                inset 0 2px 0 rgba(255,255,255,0.5);
            transform: translateY(-2px);
        }

        /* Leaf decoration */
        .leaf-decoration {
            position: fixed;
            width: 100px;
            height: 100px;
            background: radial-gradient(ellipse at center, rgba(144,238,144,0.3) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(20px);
            pointer-events: none;
            z-index: 1;
        }

        /* Aurora effect */
        .aurora {
            position: fixed;
            top: -50%;
            left: -50%;
            right: -50%;
            bottom: -50%;
            background: 
                linear-gradient(45deg, transparent 40%, rgba(135,206,250,0.1) 45%, transparent 50%),
                linear-gradient(-45deg, transparent 40%, rgba(144,238,144,0.1) 45%, transparent 50%);
            animation: aurora 20s infinite linear;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes aurora {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .text-shadow-white {
            text-shadow: 0 1px 2px rgba(255,255,255,0.8), 0 2px 4px rgba(0,100,150,0.1);
        }

        .play-overlay {
            background: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(135,206,250,0.8) 100%);
        }

        /* Mobile Mode Styles */
        body.mobile-mode .game-card .mobile-actions {
            opacity: 1 !important;
        }

        body.mobile-mode .game-card:hover {
            transform: none;
        }

        body.mobile-mode .play-overlay {
            opacity: 0 !important;
        }

        body.mobile-mode * {
            cursor: default !important;
        }

        /* Mobile card adjustments */
        body.mobile-mode .game-card {
            position: relative;
        }

        body.mobile-mode .mobile-play-btn {
            display: flex !important;
        }

        body.mobile-mode .desktop-play-btn {
            display: none !important;
        }

        /* Hide device selection after choice */
        .device-selected #device-selection {
            display: none !important;
        }

        /* Mobile touch-friendly buttons */
        body.mobile-mode button,
        body.mobile-mode a {
            min-height: 44px;
        }

        body.mobile-mode .mobile-action-bar {
            display: flex !important;
        }

        body:not(.mobile-mode) .mobile-action-bar {
            display: none !important;
        }

        body:not(.mobile-mode) .mobile-play-btn {
            display: none !important;
        }

        body:not(.mobile-mode) .desktop-play-btn {
            display: flex !important;
        }
        /* --- ULTRA OPTIMIZATION FOR MOBILE --- */
        
        /* 1. Disable Background Effects */
        body.mobile-mode .bubble,
        body.mobile-mode .leaf-decoration,
        body.mobile-mode .aurora,
        body.mobile-mode .glass-card::before,
        body.mobile-mode body::before {
            display: none !important;
        }

        /* 2. Kill Animations & Transitions globally */
        body.mobile-mode * {
            animation: none !important;
            transition: none !important;
            text-shadow: none !important;
        }

        /* 3. Remove Expensive Blur/Transparency (The Lag Killers) */
        body.mobile-mode .glass-card,
        body.mobile-mode .glass-card-dark,
        body.mobile-mode .navbar-aero,
        body.mobile-mode .modal-aero,
        body.mobile-mode #login-modal .modal-aero,
        body.mobile-mode #register-modal .modal-aero,
        body.mobile-mode #submit-modal .modal-aero,
        body.mobile-mode #edit-modal .modal-aero,
        body.mobile-mode #profile-modal .modal-aero {
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            background: #ffffff !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
            border: 1px solid #e2e8f0 !important;
            border-radius: 8px !important;
        }
        
        /* 4. Solid Background */
        body.mobile-mode {
            background: #f0f9ff !important;
        }

        /* 5. Simplified Fire Effect (Static) */
        body.mobile-mode .on-fire {
            border: 3px solid #ff4500 !important;
            box-shadow: none !important;
        }
        
        body.mobile-mode .on-fire::before {
            /* Static emoji, no movement */
            top: -10px !important;
            filter: none !important;
        }
        
        body.mobile-mode .on-fire::after {
            /* Static badge, simple gradient */
            background: #ff4500 !important;
            box-shadow: none !important;
        }

        /* 6. Simplified Inputs */
        body.mobile-mode .input-aero {
            box-shadow: none !important;
            border: 1px solid #cbd5e1 !important;
            background: #f8fafc !important;
        }

        /* 7. Navbar Simplification */
        body.mobile-mode .navbar-aero {
            background: #ffffff !important;
            border-bottom: 2px solid #38bdf8 !important;
        }

        /* 8. Footer Simplification */
        body.mobile-mode footer {
            background: #f1f5f9 !important;
            border-top: 1px solid #e2e8f0 !important;
        }

        /* 9. Card Simplification */
        body.mobile-mode .game-card {
            background: white !important;
            border-radius: 8px !important;
            margin-bottom: 12px !important;
        }
        
        body.mobile-mode .game-card img {
            border-radius: 8px 8px 0 0 !important;
        }

        /* 10. Hide complex decorative circles in Hero */
        body.mobile-mode #hero-section div[class*="absolute"] {
            display: none !important;
        }
        
        /* Keep only the top gradient bar in hero */
        body.mobile-mode #hero-section .absolute.top-0 {
            display: block !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col text-gray-700">

    <!-- Device Selection Screen -->
    <div id="device-selection" class="fixed inset-0 z-[100] flex items-center justify-center" style="background: linear-gradient(180deg, #87CEEB 0%, #E0F7FA 30%, #B2EBF2 60%, #4FC3F7 100%);">
        <!-- Bubbles decoration -->
        <div class="bubble" style="width: 80px; height: 80px; left: 15%; top: 25%; animation-delay: 0s;"></div>
        <div class="bubble" style="width: 50px; height: 50px; left: 75%; top: 35%; animation-delay: 2s;"></div>
        <div class="bubble" style="width: 60px; height: 60px; left: 25%; top: 65%; animation-delay: 4s;"></div>
        <div class="bubble" style="width: 40px; height: 40px; left: 85%; top: 75%; animation-delay: 1s;"></div>
        
        <div class="glass-card p-8 md:p-12 max-w-lg mx-4 text-center relative overflow-hidden">
            <!-- Top gradient bar -->
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-sky-400 via-teal-400 to-green-400"></div>
            
            <!-- Logo -->
            <div class="mb-6">
                <div class="glossy-btn p-4 rounded-2xl inline-block mb-4">
                    <i class="fa-solid fa-gamepad text-white text-4xl"></i>
                </div>
                <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-sky-600 to-teal-500 bg-clip-text text-transparent">GLSHub</h1>
                <p class="text-gray-500 mt-2">Plataforma de Jogos HTML</p>
            </div>
            
            <p class="text-gray-600 mb-8">Como voc√™ est√° acessando?</p>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <!-- Mobile Button -->
                <button onclick="app.selectDevice('mobile')" class="glossy-btn-green text-white font-bold py-4 px-8 rounded-xl text-lg transition-all hover:scale-105 flex items-center justify-center gap-3">
                    <i class="fa-solid fa-mobile-screen text-2xl"></i>
                    <div class="text-left">
                        <div>Mobile</div>
                        <div class="text-xs font-normal opacity-80">Celular / Tablet</div>
                    </div>
                </button>
                
                <!-- PC Button -->
                <button onclick="app.selectDevice('pc')" class="glossy-btn text-white font-bold py-4 px-8 rounded-xl text-lg transition-all hover:scale-105 flex items-center justify-center gap-3">
                    <i class="fa-solid fa-desktop text-2xl"></i>
                    <div class="text-left">
                        <div>PC</div>
                        <div class="text-xs font-normal opacity-80">Computador</div>
                    </div>
                </button>
            </div>
            
            <p class="text-xs text-gray-400 mt-6">
                <i class="fa-solid fa-info-circle"></i> Escolha para otimizar sua experi√™ncia
            </p>
        </div>
    </div>

    <!-- Aurora Background Effect -->
    <div class="aurora"></div>

    <!-- Floating Bubbles -->
    <div class="bubble" style="width: 60px; height: 60px; left: 10%; top: 20%; animation-delay: 0s;"></div>
    <div class="bubble" style="width: 40px; height: 40px; left: 20%; top: 60%; animation-delay: 2s;"></div>
    <div class="bubble" style="width: 80px; height: 80px; left: 70%; top: 30%; animation-delay: 4s;"></div>
    <div class="bubble" style="width: 30px; height: 30px; left: 80%; top: 70%; animation-delay: 6s;"></div>
    <div class="bubble" style="width: 50px; height: 50px; left: 50%; top: 80%; animation-delay: 8s;"></div>
    <div class="bubble" style="width: 35px; height: 35px; left: 5%; top: 85%; animation-delay: 3s;"></div>
    <div class="bubble" style="width: 45px; height: 45px; left: 90%; top: 15%; animation-delay: 5s;"></div>

    <!-- Leaf Decorations -->
    <div class="leaf-decoration" style="top: 10%; left: 5%;"></div>
    <div class="leaf-decoration" style="bottom: 20%; right: 10%;"></div>

    <!-- Navbar -->
    <nav class="navbar-aero sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3 cursor-pointer" onclick="app.goHome()">
                    <div class="glossy-btn p-2 rounded-lg">
                        <i class="fa-solid fa-gamepad text-white text-xl"></i>
                    </div>
                    <span class="text-2xl font-bold tracking-tight bg-gradient-to-r from-sky-600 to-teal-500 bg-clip-text text-transparent">GLSHub</span>
                </div>
                
                <div class="hidden md:block">
                    <div class="ml-10 flex items-center space-x-4" id="nav-links">
                        <!-- Links din√¢micos via JS -->
                    </div>
                </div>

                <div class="md:hidden">
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-sky-600 hover:text-sky-700 p-2">
                        <i class="fa-solid fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="md:hidden hidden glass-card mx-4 mb-4" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3" id="mobile-nav-links">
                <!-- Mobile Links din√¢micos -->
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 relative z-10">
        
        <!-- Hero Section -->
        <div id="hero-section" class="text-center mb-12 py-12 glass-card relative overflow-hidden">
            <!-- Top gradient bar -->
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-sky-400 via-teal-400 to-green-400"></div>
            
            <!-- Decorative circles -->
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-gradient-to-br from-sky-200/50 to-transparent rounded-full blur-2xl"></div>
            <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-gradient-to-tr from-green-200/50 to-transparent rounded-full blur-2xl"></div>
            
            <h1 class="text-4xl md:text-5xl font-bold mb-4">
                <span class="bg-gradient-to-r from-sky-600 via-cyan-500 to-teal-500 bg-clip-text text-transparent">Bem-vindo ao</span>
                <span class="bg-gradient-to-r from-teal-500 to-green-500 bg-clip-text text-transparent">GLSHub</span>
            </h1>
            <p class="text-gray-600 text-lg max-w-2xl mx-auto mb-8 px-4">
                ‚ú® Publique seus jogos HTML, compartilhe URLs e jogue cria√ß√µes da comunidade. Simples, r√°pido e gratuito! üéÆ
            </p>
            <div id="hero-cta" class="flex flex-wrap justify-center gap-4">
                <!-- Bot√µes din√¢micos -->
            </div>
        </div>

        <!-- Search & Filter -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <h2 class="text-2xl font-bold text-sky-700 flex items-center gap-2">
                <span class="w-1.5 h-8 bg-gradient-to-b from-sky-400 to-teal-400 rounded-full"></span>
                Jogos Recentes
            </h2>
            <div class="relative w-full md:w-72">
                <input type="text" id="search-input" oninput="app.searchGames(this.value)" placeholder="üîç Buscar jogos..." class="input-aero w-full py-2.5 px-4 pl-4 text-gray-700 placeholder-gray-400">
            </div>
        </div>

        <!-- Game Grid -->
        <div id="game-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Cards de jogos ser√£o renderizados aqui -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-20 glass-card">
            <i class="fa-regular fa-folder-open text-6xl text-sky-300 mb-4"></i>
            <p class="text-xl text-gray-500">Nenhum jogo encontrado.</p>
        </div>

    </main>

    <!-- Footer -->
    <footer class="glass-card-dark py-6 mt-12 relative z-10">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm flex items-center justify-center gap-2 mb-3">
                <i class="fa-solid fa-leaf text-green-400"></i>
                ¬© 2026 GLSHub. Criado com amor para divers√£o.
                <i class="fa-solid fa-water text-sky-400"></i>
            </p>
            <button onclick="app.switchDeviceMode()" id="switch-mode-btn" class="text-xs text-sky-500 hover:text-sky-600 transition-colors flex items-center gap-1 mx-auto">
                <i class="fa-solid fa-repeat"></i>
                <span id="switch-mode-text">Trocar para PC</span>
            </button>
        </div>
    </footer>

    <!-- MODALS -->

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 z-[60] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-sky-900/30 backdrop-blur-sm transition-opacity" onclick="app.closeModal('login-modal')"></div>
            <div class="modal-aero inline-block align-middle max-w-md w-full p-6 relative z-10 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold bg-gradient-to-r from-sky-600 to-teal-500 bg-clip-text text-transparent">
                        <i class="fa-solid fa-user-circle mr-2"></i>Entrar na Conta
                    </h3>
                    <button onclick="app.closeModal('login-modal')" class="text-gray-400 hover:text-gray-600 text-xl"><i class="fa-solid fa-times"></i></button>
                </div>
                <form onsubmit="app.handleLogin(event)" class="space-y-4">
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Email (Gmail)</label>
                        <input type="email" id="login-email" required placeholder="seu.nome@gmail.com" class="input-aero w-full py-2.5 px-4">
                        <p class="text-xs text-gray-400 mt-1">‚úâÔ∏è Utilize seu endere√ßo @gmail.com para acessar.</p>
                    </div>
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Senha</label>
                        <input type="password" id="login-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="input-aero w-full py-2.5 px-4">
                    </div>
                    <button type="submit" class="glossy-btn w-full py-3 px-4 rounded-lg text-white font-semibold">
                        <i class="fa-solid fa-sign-in-alt mr-2"></i>Entrar
                    </button>
                </form>
                <div class="mt-5 text-center">
                    <p class="text-sm text-gray-500">N√£o tem conta? <a href="#" onclick="app.switchModal('login-modal', 'register-modal')" class="text-sky-500 hover:text-sky-600 font-medium">Cadastre-se</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="fixed inset-0 z-[60] hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-sky-900/30 backdrop-blur-sm transition-opacity" onclick="app.closeModal('register-modal')"></div>
            <div class="modal-aero inline-block align-middle max-w-md w-full p-6 relative z-10 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold bg-gradient-to-r from-green-500 to-teal-500 bg-clip-text text-transparent">
                        <i class="fa-solid fa-user-plus mr-2"></i>Criar Conta
                    </h3>
                    <button onclick="app.closeModal('register-modal')" class="text-gray-400 hover:text-gray-600 text-xl"><i class="fa-solid fa-times"></i></button>
                </div>
                <form onsubmit="app.handleRegister(event)" class="space-y-4">
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Nome de Usu√°rio</label>
                        <input type="text" id="reg-username" required placeholder="SeuNickname" class="input-aero w-full py-2.5 px-4">
                    </div>
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Email (Gmail)</label>
                        <input type="email" id="reg-email" required placeholder="exemplo@gmail.com" class="input-aero w-full py-2.5 px-4">
                        <p class="text-xs text-red-400 mt-1 hidden" id="reg-email-error">‚ùå √â necess√°rio usar um email @gmail.com</p>
                    </div>
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Senha</label>
                        <input type="password" id="reg-password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="input-aero w-full py-2.5 px-4">
                    </div>
                    <button type="submit" class="glossy-btn-green w-full py-3 px-4 rounded-lg text-white font-semibold">
                        <i class="fa-solid fa-check-circle mr-2"></i>Cadastrar
                    </button>
                </form>
                <div class="mt-5 text-center">
                    <p class="text-sm text-gray-500">J√° tem conta? <a href="#" onclick="app.switchModal('register-modal', 'login-modal')" class="text-sky-500 hover:text-sky-600 font-medium">Entre aqui</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Game Modal -->
    <div id="submit-modal" class="fixed inset-0 z-[60] hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-sky-900/30 backdrop-blur-sm transition-opacity" onclick="app.closeModal('submit-modal')"></div>
            <div class="modal-aero inline-block align-middle max-w-lg w-full p-6 relative z-10 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold bg-gradient-to-r from-sky-600 to-teal-500 bg-clip-text text-transparent">
                        <i class="fa-solid fa-cloud-upload-alt mr-2"></i>Publicar Novo Jogo
                    </h3>
                    <button onclick="app.closeModal('submit-modal')" class="text-gray-400 hover:text-gray-600 text-xl"><i class="fa-solid fa-times"></i></button>
                </div>
                <form onsubmit="app.handleSubmitGame(event)" class="space-y-4">
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">T√≠tulo do Jogo</label>
                        <input type="text" id="game-title" required placeholder="Ex: Super Mario Clone" class="input-aero w-full py-2.5 px-4">
                    </div>
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Descri√ß√£o Curta</label>
                        <textarea id="game-desc" rows="2" required placeholder="Descreva seu jogo..." class="input-aero w-full py-2.5 px-4 resize-none"></textarea>
                    </div>
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">URL da Imagem (Thumbnail)</label>
                        <input type="url" id="game-thumb" placeholder="https://..." class="input-aero w-full py-2.5 px-4">
                        <p class="text-xs text-gray-400 mt-1">üñºÔ∏è Deixe em branco para usar imagem padr√£o.</p>
                    </div>
                    <!-- Game Type Selection -->
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-2">Tipo de Publica√ß√£o</label>
                        <div class="flex gap-2 mb-3">
                            <button type="button" onclick="app.toggleSubmitType('url')" id="btn-type-url" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-sky-100 border-sky-300 text-sky-700 shadow-inner">
                                <i class="fa-solid fa-link mr-1"></i> Link (URL)
                            </button>
                            <button type="button" onclick="app.toggleSubmitType('html')" id="btn-type-html" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50">
                                <i class="fa-solid fa-code mr-1"></i> C√≥digo HTML
                            </button>
                        </div>
                    </div>

                    <!-- Input URL -->
                    <div id="input-container-url" class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">URL do Jogo</label>
                        <input type="url" id="game-url" placeholder="https://exemplo.com/jogo" class="input-aero w-full py-2.5 px-4">
                        <p class="text-xs text-amber-500 mt-1"><i class="fa-solid fa-triangle-exclamation"></i> Certifique-se que o link permite embed (iframe).</p>
                    </div>

                    <!-- Input HTML -->
                    <div id="input-container-html" class="text-left hidden">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Cole o C√≥digo HTML</label>
                        <textarea id="game-html" rows="6" placeholder="<!DOCTYPE html><html>...</html>" class="input-aero w-full py-2.5 px-4 font-mono text-xs"></textarea>
                        <p class="text-xs text-gray-400 mt-1">üìù Cole o c√≥digo completo do seu jogo aqui (HTML/JS/CSS).</p>
                    </div>
                    <!-- Privacy Toggle -->
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-2">Visibilidade</label>
                        <div class="flex gap-2">
                            <button type="button" onclick="app.togglePrivacy('public', 'submit')" id="btn-privacy-public" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-green-100 border-green-300 text-green-700 shadow-inner">
                                <i class="fa-solid fa-globe mr-1"></i> P√∫blico
                            </button>
                            <button type="button" onclick="app.togglePrivacy('private', 'submit')" id="btn-privacy-private" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50">
                                <i class="fa-solid fa-lock mr-1"></i> Privado
                            </button>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">üîí Jogos privados s√≥ aparecem para voc√™.</p>
                    </div>

                    <button type="submit" class="glossy-btn w-full py-3 px-4 rounded-lg text-white font-semibold">
                        <i class="fa-solid fa-rocket mr-2"></i>Publicar Jogo
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Game Modal -->
    <div id="edit-modal" class="fixed inset-0 z-[60] hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-sky-900/30 backdrop-blur-sm transition-opacity" onclick="app.closeModal('edit-modal')"></div>
            <div class="modal-aero inline-block align-middle max-w-lg w-full p-6 relative z-10 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold bg-gradient-to-r from-amber-500 to-orange-500 bg-clip-text text-transparent">
                        <i class="fa-solid fa-pen-to-square mr-2"></i>Editar Jogo
                    </h3>
                    <button onclick="app.closeModal('edit-modal')" class="text-gray-400 hover:text-gray-600 text-xl"><i class="fa-solid fa-times"></i></button>
                </div>
                <form onsubmit="app.handleEditGame(event)" class="space-y-4">
                    <input type="hidden" id="edit-game-id">
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">T√≠tulo do Jogo</label>
                        <input type="text" id="edit-game-title" required placeholder="Ex: Super Mario Clone" class="input-aero w-full py-2.5 px-4">
                    </div>
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Descri√ß√£o Curta</label>
                        <textarea id="edit-game-desc" rows="2" required placeholder="Descreva seu jogo..." class="input-aero w-full py-2.5 px-4 resize-none"></textarea>
                    </div>
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">URL da Imagem (Thumbnail)</label>
                        <input type="url" id="edit-game-thumb" placeholder="https://..." class="input-aero w-full py-2.5 px-4">
                        <p class="text-xs text-gray-400 mt-1">üñºÔ∏è Deixe em branco para usar imagem padr√£o.</p>
                    </div>
                    <!-- Game Type Selection -->
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-2">Tipo de Publica√ß√£o</label>
                        <div class="flex gap-2 mb-3">
                            <button type="button" onclick="app.toggleEditType('url')" id="edit-btn-type-url" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-sky-100 border-sky-300 text-sky-700 shadow-inner">
                                <i class="fa-solid fa-link mr-1"></i> Link (URL)
                            </button>
                            <button type="button" onclick="app.toggleEditType('html')" id="edit-btn-type-html" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50">
                                <i class="fa-solid fa-code mr-1"></i> C√≥digo HTML
                            </button>
                        </div>
                    </div>

                    <!-- Input URL -->
                    <div id="edit-input-container-url" class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-1">URL do Jogo</label>
                        <input type="url" id="edit-game-url" placeholder="https://exemplo.com/jogo" class="input-aero w-full py-2.5 px-4">
                        <p class="text-xs text-amber-500 mt-1"><i class="fa-solid fa-triangle-exclamation"></i> Certifique-se que o link permite embed (iframe).</p>
                    </div>

                    <!-- Input HTML -->
                    <div id="edit-input-container-html" class="text-left hidden">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Cole o C√≥digo HTML</label>
                        <textarea id="edit-game-html" rows="6" placeholder="<!DOCTYPE html><html>...</html>" class="input-aero w-full py-2.5 px-4 font-mono text-xs"></textarea>
                        <p class="text-xs text-gray-400 mt-1">üìù Cole o c√≥digo completo do seu jogo aqui (HTML/JS/CSS).</p>
                    </div>

                    <!-- Privacy Toggle -->
                    <div class="text-left">
                        <label class="block text-sm font-medium text-gray-600 mb-2">Visibilidade</label>
                        <div class="flex gap-2">
                            <button type="button" onclick="app.togglePrivacy('public', 'edit')" id="edit-btn-privacy-public" class="flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-green-100 border-green-300 text-green-700 shadow-inner">
                                <i class="fa-solid fa-globe mr-1"></i> P√∫blico
                            </button>
                            <button type="button" onclick="app.togglePrivacy('private', 'edit')" id="edit-btn-privacy-private" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50">
                                <i class="fa-solid fa-lock mr-1"></i> Privado
                            </button>
                        </div>
                        <p class="text-xs text-gray-400 mt-1">üîí Jogos privados s√≥ aparecem para voc√™ e admins.</p>
                    </div>

                    <div class="flex gap-3">
                        <button type="button" onclick="app.closeModal('edit-modal')" class="flex-1 py-3 px-4 rounded-lg font-semibold border border-gray-300 text-gray-600 hover:bg-gray-50 transition-all">
                            Cancelar
                        </button>
                        <button type="submit" class="flex-1 glossy-btn-green py-3 px-4 rounded-lg text-white font-semibold">
                            <i class="fa-solid fa-save mr-2"></i>Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="fixed inset-0 z-[60] hidden overflow-y-auto" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:p-0">
            <div class="fixed inset-0 bg-sky-900/30 backdrop-blur-sm transition-opacity" onclick="app.closeModal('profile-modal')"></div>
            <div class="modal-aero inline-block align-middle max-w-2xl w-full p-0 relative z-10 transform transition-all overflow-hidden">
                <!-- Banner -->
                <div id="profile-banner" class="h-32 bg-gradient-to-r from-sky-400 via-teal-400 to-green-400 relative">
                    <div class="absolute inset-0 bg-cover bg-center" id="profile-banner-preview"></div>
                    <button onclick="app.closeModal('profile-modal')" class="absolute top-3 right-3 bg-white/80 hover:bg-white text-gray-600 w-8 h-8 rounded-full flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                
                <!-- Avatar -->
                <div class="relative -mt-12 flex justify-center">
                    <div id="profile-avatar" class="w-24 h-24 rounded-full bg-gradient-to-br from-sky-400 to-teal-400 flex items-center justify-center text-3xl text-white font-bold shadow-xl border-4 border-white overflow-hidden">
                        <span id="profile-avatar-letter">U</span>
                        <img id="profile-avatar-img" class="w-full h-full object-cover hidden" src="" alt="Avatar">
                    </div>
                </div>
                
                <!-- Profile Info Display -->
                <div id="profile-display" class="p-6">
                    <h3 id="profile-display-name" class="text-2xl font-bold text-gray-700 text-center mb-1">Nome do Usu√°rio</h3>
                    <p id="profile-display-url" class="text-sky-500 text-sm text-center mb-3"></p>
                    <p id="profile-display-bio" class="text-gray-500 text-center mb-4 max-w-md mx-auto"></p>
                    
                    <div id="profile-stats" class="flex justify-center gap-8 mb-6">
                        <div class="text-center">
                            <div id="profile-games-count" class="text-2xl font-bold text-sky-600">0</div>
                            <div class="text-xs text-gray-400">Jogos</div>
                        </div>
                    </div>
                    
                    <button id="profile-edit-btn" onclick="app.toggleProfileEdit(true)" class="glossy-btn text-white px-6 py-2 rounded-lg font-medium hidden">
                        <i class="fa-solid fa-pen mr-2"></i>Editar Perfil
                    </button>
                </div>
                
                <!-- Profile Edit Form (hidden by default) -->
                <div id="profile-edit" class="p-6 hidden">
                    <h3 class="text-xl font-bold bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent mb-4">
                        <i class="fa-solid fa-user-edit mr-2"></i>Editar Perfil
                    </h3>
                    <form onsubmit="app.handleSaveProfile(event)" class="space-y-4">
                        <div class="text-left">
                            <label class="block text-sm font-medium text-gray-600 mb-1">Nome de Exibi√ß√£o</label>
                            <input type="text" id="profile-edit-name" required placeholder="Seu nome..." class="input-aero w-full py-2.5 px-4">
                        </div>
                        <div class="text-left">
                            <label class="block text-sm font-medium text-gray-600 mb-1">Bio</label>
                            <textarea id="profile-edit-bio" rows="3" placeholder="Conte um pouco sobre voc√™..." class="input-aero w-full py-2.5 px-4 resize-none"></textarea>
                        </div>
                        <div class="text-left">
                            <label class="block text-sm font-medium text-gray-600 mb-1">URL Personalizada</label>
                            <div class="flex">
                                <span class="inline-flex items-center px-3 text-sm text-gray-500 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md">glshub.com/</span>
                                <input type="text" id="profile-edit-url" placeholder="seu-nome" class="input-aero flex-1 py-2.5 px-4 rounded-l-none">
                            </div>
                        </div>
                        <div class="text-left">
                            <label class="block text-sm font-medium text-gray-600 mb-1">URL do Banner (GIF ou imagem)</label>
                            <input type="url" id="profile-edit-banner" placeholder="https://..." class="input-aero w-full py-2.5 px-4">
                            <p class="text-xs text-gray-400 mt-1">üé® Voc√™ pode usar GIFs animados para um banner animado!</p>
                        </div>
                        <div class="text-left">
                            <label class="block text-sm font-medium text-gray-600 mb-1">URL da Foto de Perfil</label>
                            <input type="url" id="profile-edit-avatar" placeholder="https://..." class="input-aero w-full py-2.5 px-4">
                            <p class="text-xs text-gray-400 mt-1">üì∑ Adicione uma foto ou GIF para seu avatar!</p>
                        </div>
                        <div class="flex gap-3 pt-2">
                            <button type="button" onclick="app.toggleProfileEdit(false)" class="flex-1 py-3 px-4 rounded-lg font-semibold border border-gray-300 text-gray-600 hover:bg-gray-50 transition-all">
                                Cancelar
                            </button>
                            <button type="submit" class="flex-1 glossy-btn-green py-3 px-4 rounded-lg text-white font-semibold">
                                <i class="fa-solid fa-save mr-2"></i>Salvar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Play Game Modal -->
    <div id="play-modal" class="fixed inset-0 z-[70] hidden overflow-hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-gradient-to-b from-sky-100/95 to-white/95 backdrop-blur-md flex flex-col">
            <!-- Header do Player -->
            <div class="navbar-aero p-4 flex justify-between items-center shrink-0">
                <div class="flex items-center gap-3">
                    <button onclick="app.closeModal('play-modal')" class="glossy-btn text-white px-3 py-2 rounded-lg">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <h2 id="play-title" class="text-xl font-bold text-sky-700">Jogando...</h2>
                    <span id="play-author" class="text-sm text-gray-500 bg-sky-100 px-3 py-1 rounded-full border border-sky-200">Autor</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="app.toggleFullscreen()" class="glossy-btn text-white px-3 py-2 rounded-lg" title="Tela Cheia">
                        <i class="fa-solid fa-expand"></i>
                    </button>
                </div>
            </div>
            
            <!-- Iframe Container -->
            <div class="flex-grow relative bg-white flex justify-center items-center overflow-hidden m-4 rounded-2xl shadow-2xl border border-white/50">
                <div id="loading-spinner" class="absolute text-sky-400 text-5xl animate-spin">
                    <i class="fa-solid fa-circle-notch"></i>
                </div>
                <iframe id="game-iframe" class="w-full h-full border-0 rounded-2xl" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, onSnapshot, doc, updateDoc, deleteDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyCS1NBS0qrLiCpV_OSqpUKoipxzdGiUQ48",
            authDomain: "glshub.firebaseapp.com",
            projectId: "glshub",
            storageBucket: "glshub.firebasestorage.app",
            messagingSenderId: "1020833468968",
            appId: "1:1020833468968:web:adb9e1e604ebcc1e98db1d",
            measurementId: "G-1TGK9KLKQL"
        };

        // Initialize Firebase
        const firebaseApp = initializeApp(firebaseConfig);
        const analytics = getAnalytics(firebaseApp);
        const auth = getAuth(firebaseApp);
        const db = getFirestore(firebaseApp);

        // APP LOGIC
        window.app = {
            state: {
                currentUser: null,
                games: [],
                deviceMode: null
            },

            init() {
                // Check if device was already selected
                const savedDevice = localStorage.getItem('glshub-device');
                if (savedDevice) {
                    this.applyDeviceMode(savedDevice);
                }
                this.setupAuthListener();
                this.setupGamesListener();
                
                const iframe = document.getElementById('game-iframe');
                if(iframe) {
                    iframe.onload = () => {
                        const spinner = document.getElementById('loading-spinner');
                        if(spinner) spinner.style.display = 'none';
                    };
                }
            },

            setupAuthListener() {
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        this.state.currentUser = {
                            username: user.displayName || user.email.split('@')[0],
                            email: user.email.toLowerCase(),
                            uid: user.uid
                        };
                        this.renderNav();
                        this.renderHeroCTA();
                        this.renderGames(); // Re-render games to show admin buttons
                        console.log("User logged in:", this.state.currentUser.username, "| Admin:", this.isAdmin());
                    } else {
                        this.state.currentUser = null;
                        this.renderNav();
                        this.renderHeroCTA();
                        this.renderGames(); // Re-render games to hide admin buttons
                        console.log("User logged out");
                    }
                });
            },

            setupGamesListener() {
                const q = query(collection(db, "games"), orderBy("timestamp", "desc"));
                onSnapshot(q, (querySnapshot) => {
                    this.state.games = [];
                    querySnapshot.forEach((doc) => {
                        this.state.games.push({ id: doc.id, ...doc.data() });
                    });
                    this.renderGames();
                }, (error) => {
                    console.error("Error getting games:", error);
                });
            },

            // --- AUTH ---

            async handleRegister(e) {
                e.preventDefault();
                const username = document.getElementById('reg-username').value;
                const email = document.getElementById('reg-email').value.toLowerCase();
                const password = document.getElementById('reg-password').value;
                const errorMsg = document.getElementById('reg-email-error');

                if (!email.endsWith('@gmail.com')) {
                    errorMsg.classList.remove('hidden');
                    return;
                }
                errorMsg.classList.add('hidden');

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;
                    
                    // Update profile with username
                    await updateProfile(user, {
                        displayName: username
                    });

                    // Force local state update
                    this.state.currentUser = {
                        username: username,
                        email: email,
                        uid: user.uid
                    };

                    if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playSuccess();
                    this.showToast('‚úÖ Cadastro realizado com sucesso!', 'green');
                    this.closeModal('register-modal');
                } catch (error) {
                    console.error("Register Error:", error);
                    let msg = 'Erro ao cadastrar.';
                    if (error.code === 'auth/email-already-in-use') msg = 'Este email j√° est√° em uso.';
                    if (error.code === 'auth/weak-password') msg = 'A senha deve ter pelo menos 6 caracteres.';
                    alert(msg);
                }
            },

            async handleLogin(e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value.toLowerCase();
                const password = document.getElementById('login-password').value;

                if (!email.endsWith('@gmail.com')) {
                    alert('Por favor, utilize um email @gmail.com');
                    return;
                }

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    this.closeModal('login-modal');
                    if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playSuccess();
                    this.showToast(`üéâ Bem-vindo de volta!`, 'sky');
                } catch (error) {
                    console.error("Login Error:", error);
                    let msg = 'Erro ao entrar.';
                    if (error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                        msg = 'Email ou senha incorretos.';
                    }
                    alert(msg);
                }
            },

            async logout() {
                if(confirm('Tem certeza que deseja sair?')) {
                    try {
                        await signOut(auth);
                        this.showToast('üëã Voc√™ saiu da conta.', 'gray');
                    } catch (error) {
                        console.error("Logout Error:", error);
                    }
                }
            },

            // --- ADMIN ---
            isAdmin() {
                if (!this.state.currentUser || !this.state.currentUser.email) return false;
                return this.state.currentUser.email.toLowerCase() === 'admin12ofcl@gmail.com';
            },

            // --- GAMES CRUD ---

            toggleSubmitType(type) {
                const btnUrl = document.getElementById('btn-type-url');
                const btnHtml = document.getElementById('btn-type-html');
                const containerUrl = document.getElementById('input-container-url');
                const containerHtml = document.getElementById('input-container-html');
                const inputUrl = document.getElementById('game-url');
                const inputHtml = document.getElementById('game-html');

                if (type === 'url') {
                    // UI Styles
                    btnUrl.className = "flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-sky-100 border-sky-300 text-sky-700 shadow-inner";
                    btnHtml.className = "flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50";
                    
                    // Visibility
                    containerUrl.classList.remove('hidden');
                    containerHtml.classList.add('hidden');
                    
                    // Required attribute handling
                    inputUrl.setAttribute('required', '');
                    inputHtml.removeAttribute('required');
                } else {
                    // UI Styles
                    btnHtml.className = "flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-sky-100 border-sky-300 text-sky-700 shadow-inner";
                    btnUrl.className = "flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50";
                    
                    // Visibility
                    containerHtml.classList.remove('hidden');
                    containerUrl.classList.add('hidden');
                    
                    // Required attribute handling
                    inputHtml.setAttribute('required', '');
                    inputUrl.removeAttribute('required');
                }
            },

            // Privacy state
            submitPrivacy: 'public',
            editPrivacy: 'public',

            togglePrivacy(privacy, modal) {
                const prefix = modal === 'edit' ? 'edit-' : '';
                const btnPublic = document.getElementById(`${prefix}btn-privacy-public`);
                const btnPrivate = document.getElementById(`${prefix}btn-privacy-private`);

                if (privacy === 'public') {
                    btnPublic.className = "flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-green-100 border-green-300 text-green-700 shadow-inner";
                    btnPrivate.className = "flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50";
                } else {
                    btnPrivate.className = "flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-red-100 border-red-300 text-red-700 shadow-inner";
                    btnPublic.className = "flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50";
                }

                if (modal === 'edit') {
                    this.editPrivacy = privacy;
                } else {
                    this.submitPrivacy = privacy;
                }
            },

            async handleSubmitGame(e) {
                e.preventDefault();
                if (!auth.currentUser) return;

                const title = document.getElementById('game-title').value;
                const desc = document.getElementById('game-desc').value;
                const thumb = document.getElementById('game-thumb').value || 'https://placehold.co/600x400/87CEEB/FFF?text=üéÆ+GAME';
                
                // Determine type
                const isUrlMode = !document.getElementById('input-container-url').classList.contains('hidden');
                
                const newGame = {
                    title,
                    desc,
                    thumb,
                    author: this.state.currentUser.username,
                    uid: this.state.currentUser.uid,
                    timestamp: Date.now(),
                    type: isUrlMode ? 'url' : 'html',
                    content: isUrlMode ? document.getElementById('game-url').value : document.getElementById('game-html').value,
                    isPrivate: this.submitPrivacy === 'private'
                };

                try {
                    await addDoc(collection(db, "games"), newGame);
                    
                    this.closeModal('submit-modal');
                    e.target.reset();
                    this.toggleSubmitType('url');
                    this.togglePrivacy('public', 'submit');
                    
                    if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playSuccess();
                    this.showToast('üöÄ Jogo publicado no Firebase!', 'green');
                    
                    const grid = document.getElementById('game-grid');
                    if(grid) window.scrollTo({ top: grid.offsetTop - 100, behavior: 'smooth' });

                } catch (e) {
                    console.error("Error adding document: ", e);
                    alert("Erro ao publicar jogo.");
                }
            },

            searchGames(query) {
                // Client-side filtering of the realtime list
                const filtered = this.state.games.filter(g => 
                    g.title.toLowerCase().includes(query.toLowerCase()) || 
                    g.desc.toLowerCase().includes(query.toLowerCase())
                );
                this.renderGames(filtered);
            },

            playGame(id) {
                // Find game by ID (string from firestore)
                const game = this.state.games.find(g => g.id === id);
                if (!game) return;

                document.getElementById('play-title').innerText = game.title;
                document.getElementById('play-author').innerText = 'üë§ ' + game.author;
                
                const iframe = document.getElementById('game-iframe');
                
                // Reset iframe
                iframe.src = '';
                iframe.removeAttribute('srcdoc');
                
                document.getElementById('loading-spinner').style.display = 'block';
                
                setTimeout(() => {
                    if (game.type === 'html') {
                        iframe.srcdoc = game.content;
                    } else {
                        iframe.src = game.content || game.url;
                    }
                }, 100);

                this.openModal('play-modal');
            },

            // --- EDIT GAME ---

            toggleEditType(type) {
                const btnUrl = document.getElementById('edit-btn-type-url');
                const btnHtml = document.getElementById('edit-btn-type-html');
                const containerUrl = document.getElementById('edit-input-container-url');
                const containerHtml = document.getElementById('edit-input-container-html');
                const inputUrl = document.getElementById('edit-game-url');
                const inputHtml = document.getElementById('edit-game-html');

                if (type === 'url') {
                    btnUrl.className = "flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-sky-100 border-sky-300 text-sky-700 shadow-inner";
                    btnHtml.className = "flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50";
                    containerUrl.classList.remove('hidden');
                    containerHtml.classList.add('hidden');
                    inputUrl.setAttribute('required', '');
                    inputHtml.removeAttribute('required');
                } else {
                    btnHtml.className = "flex-1 py-2 px-3 rounded-lg text-sm font-bold border transition-all bg-sky-100 border-sky-300 text-sky-700 shadow-inner";
                    btnUrl.className = "flex-1 py-2 px-3 rounded-lg text-sm font-medium border transition-all bg-white border-gray-300 text-gray-500 hover:bg-gray-50";
                    containerHtml.classList.remove('hidden');
                    containerUrl.classList.add('hidden');
                    inputHtml.setAttribute('required', '');
                    inputUrl.removeAttribute('required');
                }
            },

            openEditModal(id) {
                const game = this.state.games.find(g => g.id === id);
                if (!game) return;
                
                // Check ownership OR admin
                if (!this.state.currentUser || (game.uid !== this.state.currentUser.uid && !this.isAdmin())) {
                    alert('Voc√™ n√£o tem permiss√£o para editar este jogo.');
                    return;
                }

                // Fill form with game data
                document.getElementById('edit-game-id').value = game.id;
                document.getElementById('edit-game-title').value = game.title;
                document.getElementById('edit-game-desc').value = game.desc;
                document.getElementById('edit-game-thumb').value = game.thumb || '';

                // Set correct type
                if (game.type === 'html') {
                    this.toggleEditType('html');
                    document.getElementById('edit-game-html').value = game.content || '';
                    document.getElementById('edit-game-url').value = '';
                } else {
                    this.toggleEditType('url');
                    document.getElementById('edit-game-url').value = game.content || '';
                    document.getElementById('edit-game-html').value = '';
                }

                // Set privacy
                this.togglePrivacy(game.isPrivate ? 'private' : 'public', 'edit');

                this.openModal('edit-modal');
            },

            async handleEditGame(e) {
                e.preventDefault();
                if (!auth.currentUser) return;

                const gameId = document.getElementById('edit-game-id').value;
                const game = this.state.games.find(g => g.id === gameId);
                
                // Check ownership OR admin
                if (!game || (game.uid !== this.state.currentUser.uid && !this.isAdmin())) {
                    alert('Voc√™ n√£o tem permiss√£o para editar este jogo.');
                    return;
                }

                const title = document.getElementById('edit-game-title').value;
                const desc = document.getElementById('edit-game-desc').value;
                const thumb = document.getElementById('edit-game-thumb').value || 'https://placehold.co/600x400/87CEEB/FFF?text=üéÆ+GAME';
                
                const isUrlMode = !document.getElementById('edit-input-container-url').classList.contains('hidden');
                
                const updatedData = {
                    title,
                    desc,
                    thumb,
                    type: isUrlMode ? 'url' : 'html',
                    content: isUrlMode ? document.getElementById('edit-game-url').value : document.getElementById('edit-game-html').value,
                    isPrivate: this.editPrivacy === 'private',
                    updatedAt: Date.now()
                };

                try {
                    const gameRef = doc(db, "games", gameId);
                    await updateDoc(gameRef, updatedData);
                    
                    this.closeModal('edit-modal');
                    
                    if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playSuccess();
                    this.showToast('‚úèÔ∏è Jogo atualizado com sucesso!', 'green');

                } catch (error) {
                    console.error("Error updating document: ", error);
                    alert("Erro ao atualizar jogo.");
                }
            },

            async deleteGame(id) {
                const game = this.state.games.find(g => g.id === id);
                if (!game) return;
                
                // Check ownership OR admin
                if (!this.state.currentUser || (game.uid !== this.state.currentUser.uid && !this.isAdmin())) {
                    alert('Voc√™ n√£o tem permiss√£o para excluir este jogo.');
                    return;
                }

                if (!confirm(`Tem certeza que deseja excluir "${game.title}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
                    return;
                }

                try {
                    const gameRef = doc(db, "games", id);
                    await deleteDoc(gameRef);
                    
                    if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playClose();
                    this.showToast('üóëÔ∏è Jogo exclu√≠do.', 'gray');

                } catch (error) {
                    console.error("Error deleting document: ", error);
                    alert("Erro ao excluir jogo.");
                }
            },

            // --- FIRE SYSTEM (Admin only) ---
            async toggleFire(id) {
                // Only admin can toggle fire
                if (!this.isAdmin()) {
                    alert('Apenas administradores podem destacar jogos.');
                    return;
                }

                const game = this.state.games.find(g => g.id === id);
                if (!game) return;

                try {
                    const gameRef = doc(db, "games", id);
                    const newFireState = !game.onFire;
                    
                    await updateDoc(gameRef, {
                        onFire: newFireState
                    });
                    
                    if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playSuccess();
                    
                    if (newFireState) {
                        this.showToast('üî• Jogo colocado em destaque!', 'orange');
                    } else {
                        this.showToast('‚ùÑÔ∏è Destaque removido do jogo.', 'gray');
                    }

                } catch (error) {
                    console.error("Error toggling fire: ", error);
                    alert("Erro ao alterar destaque.");
                }
            },

            // --- UI RENDERING ---

            renderNav() {
                const desktopNav = document.getElementById('nav-links');
                const mobileNav = document.getElementById('mobile-nav-links');
                
                let html = '';
                let mobileHtml = '';

                if (this.state.currentUser) {
                    const userHtml = `
                        <a href="#" onclick="app.openModal('submit-modal')" class="glossy-btn text-white px-4 py-2 rounded-lg text-sm font-medium"><i class="fa-solid fa-plus mr-1"></i> Publicar</a>
                        <a href="#" onclick="app.openProfile('${this.state.currentUser.uid}')" class="text-sky-600 px-4 py-2 text-sm font-medium border border-sky-300 rounded-full bg-sky-50 hover:bg-sky-100 transition-colors">üë§ ${this.state.currentUser.username}</a>
                        <a href="#" onclick="app.logout()" class="text-red-400 hover:text-red-500 px-3 py-2 rounded-md text-sm font-medium"><i class="fa-solid fa-sign-out-alt"></i></a>
                    `;
                    
                    const mobileUserHtml = `
                        <a href="#" onclick="app.openModal('submit-modal')" class="text-sky-600 hover:bg-sky-50 block px-3 py-2 rounded-md text-base font-medium">üì§ Publicar Jogo</a>
                        <a href="#" onclick="app.openProfile('${this.state.currentUser.uid}')" class="text-purple-600 hover:bg-purple-50 block px-3 py-2 rounded-md text-base font-medium">üë§ Meu Perfil</a>
                        <a href="#" onclick="app.logout()" class="text-red-400 hover:bg-red-50 block px-3 py-2 rounded-md text-base font-medium">üö™ Sair</a>
                    `;

                    html = userHtml;
                    mobileHtml = mobileUserHtml;
                } else {
                    const guestHtml = `
                        <a href="#" onclick="app.openModal('login-modal')" class="text-gray-600 hover:text-sky-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Entrar</a>
                        <a href="#" onclick="app.openModal('register-modal')" class="glossy-btn-green text-white px-4 py-2 rounded-lg text-sm font-medium">Criar Conta</a>
                    `;

                    const mobileGuestHtml = `
                        <a href="#" onclick="app.openModal('login-modal')" class="text-gray-600 hover:bg-sky-50 block px-3 py-2 rounded-md text-base font-medium">üîë Entrar</a>
                        <a href="#" onclick="app.openModal('register-modal')" class="text-green-600 hover:bg-green-50 block px-3 py-2 rounded-md text-base font-medium">‚ú® Criar Conta</a>
                    `;

                    html = guestHtml;
                    mobileHtml = mobileGuestHtml;
                }

                if(desktopNav) desktopNav.innerHTML = html;
                if(mobileNav) mobileNav.innerHTML = mobileHtml;
            },

            renderHeroCTA() {
                const container = document.getElementById('hero-cta');
                if(!container) return;
                
                if (this.state.currentUser) {
                    container.innerHTML = `
                         <button onclick="app.openModal('submit-modal')" class="glossy-btn text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105">
                            <i class="fa-solid fa-upload mr-2"></i> Enviar Jogo
                        </button>
                    `;
                } else {
                    container.innerHTML = `
                        <button onclick="app.openModal('register-modal')" class="glossy-btn-green text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105">
                            ‚ú® Come√ßar Agora
                        </button>
                        <button onclick="document.getElementById('game-grid').scrollIntoView({behavior: 'smooth'})" class="glossy-btn text-white font-bold py-3 px-8 rounded-full shadow-lg transition">
                            üéÆ Explorar Jogos
                        </button>
                    `;
                }
            },

            renderGames(gamesList = null) {
                const grid = document.getElementById('game-grid');
                const empty = document.getElementById('empty-state');
                let list = gamesList || this.state.games;

                if(!grid || !empty) return;

                // Filter private games - only show to owner or admin
                list = list.filter(game => {
                    if (!game.isPrivate) return true; // Public games always show
                    if (!this.state.currentUser) return false; // Not logged in, hide private
                    if (this.isAdmin()) return true; // Admin sees all
                    return game.uid === this.state.currentUser.uid; // Owner sees their own
                });

                grid.innerHTML = '';

                if (list.length === 0) {
                    empty.classList.remove('hidden');
                    return;
                }
                empty.classList.add('hidden');

                list.forEach(game => {
                    const card = document.createElement('div');
                    const fireClass = game.onFire ? 'on-fire' : '';
                    card.className = `game-card glass-card overflow-hidden flex flex-col h-full ${fireClass}`;
                    
                    // Check if current user is the owner OR admin
                    const isOwner = this.state.currentUser && (game.uid === this.state.currentUser.uid || this.isAdmin());
                    
                    // Private badge
                    const privateBadge = game.isPrivate ? `
                        <span class="absolute top-2 left-2 bg-red-500/90 text-white text-xs px-2 py-1 rounded-full z-10 flex items-center gap-1 shadow-lg">
                            <i class="fa-solid fa-lock text-[10px]"></i> Privado
                        </span>
                    ` : '';
                    
                    // Fire button (only for admin)
                    const fireButton = this.isAdmin() ? `
                        <button onclick="event.stopPropagation(); app.toggleFire('${game.id}')" class="${game.onFire ? 'fire-btn' : 'bg-white/90 hover:bg-orange-100'} text-orange-500 p-2 rounded-lg shadow-md border border-white/50 transition-all" title="${game.onFire ? 'Remover Destaque' : 'Colocar em Destaque'}">
                            <i class="fa-solid fa-fire text-sm"></i>
                        </button>
                    ` : '';

                    // Edit/Delete buttons (only for owner) - different for mobile/pc
                    const isMobile = this.isMobileMode();
                    
                    const ownerButtons = isOwner ? `
                        <div class="absolute top-2 right-2 flex gap-1 ${isMobile ? 'opacity-100 mobile-actions' : 'opacity-0 group-hover:opacity-100'} transition-opacity z-10">
                            ${fireButton}
                            <button onclick="event.stopPropagation(); app.openEditModal('${game.id}')" class="bg-white/90 hover:bg-amber-100 text-amber-600 p-2 rounded-lg shadow-md border border-white/50 transition-all" title="Editar">
                                <i class="fa-solid fa-pen text-sm"></i>
                            </button>
                            <button onclick="event.stopPropagation(); app.deleteGame('${game.id}')" class="bg-white/90 hover:bg-red-100 text-red-500 p-2 rounded-lg shadow-md border border-white/50 transition-all" title="Excluir">
                                <i class="fa-solid fa-trash text-sm"></i>
                            </button>
                        </div>
                    ` : (this.isAdmin() ? `
                        <div class="absolute top-2 right-2 flex gap-1 ${isMobile ? 'opacity-100 mobile-actions' : 'opacity-0 group-hover:opacity-100'} transition-opacity z-10">
                            ${fireButton}
                        </div>
                    ` : '');
                    
                    // Mobile-specific play button overlay
                    const mobilePlayOverlay = isMobile ? `
                        <div class="mobile-play-btn absolute inset-0 flex items-center justify-center bg-gradient-to-t from-black/50 to-transparent">
                            <button onclick="app.playGame('${game.id}')" class="glossy-btn p-5 rounded-full shadow-xl transform hover:scale-110 transition-transform">
                                <i class="fa-solid fa-play text-white text-3xl"></i>
                            </button>
                        </div>
                    ` : '';
                    
                    card.innerHTML = `
                        <div class="h-48 overflow-hidden relative group cursor-pointer" onclick="app.playGame('${game.id}')">
                            ${privateBadge}
                            ${ownerButtons}
                            <img src="${game.thumb}" alt="${game.title}" class="w-full h-full object-cover ${isMobile ? '' : 'group-hover:scale-110'} transition-transform duration-500" onerror="this.src='https://placehold.co/600x400/87CEEB/FFF?text=üéÆ'">
                            ${isMobile ? mobilePlayOverlay : `
                            <div class="play-overlay absolute inset-0 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity duration-300">
                                <div class="glossy-btn p-4 rounded-full">
                                    <i class="fa-solid fa-play text-white text-2xl"></i>
                                </div>
                            </div>
                            `}
                        </div>
                        <div class="p-5 flex-grow flex flex-col bg-gradient-to-b from-white/80 to-sky-50/50">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-xl font-bold text-gray-700 truncate w-3/4" title="${game.title}">${game.title}</h3>
                                <span class="bg-gradient-to-r from-sky-100 to-teal-100 text-xs text-sky-600 px-2 py-1 rounded-full border border-sky-200">HTML5</span>
                            </div>
                            <p class="text-gray-500 text-sm mb-4 line-clamp-2 flex-grow">${game.desc}</p>
                            <div class="flex items-center justify-between mt-auto pt-4 border-t border-sky-100">
                                <div class="flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity" onclick="event.stopPropagation(); app.openProfile('${game.uid}')">
                                    <div class="w-7 h-7 rounded-full bg-gradient-to-br from-sky-400 to-teal-400 flex items-center justify-center text-xs text-white font-bold shadow-md">
                                        ${game.author ? game.author.charAt(0).toUpperCase() : 'A'}
                                    </div>
                                    <span class="text-xs text-gray-500 truncate max-w-[80px] hover:text-sky-600">${game.author || 'Anon'}</span>
                                </div>
                                <button onclick="app.playGame('${game.id}')" class="desktop-play-btn glossy-btn text-white text-sm font-medium px-4 py-1.5 rounded-full">
                                    JOGAR <i class="fa-solid fa-arrow-right ml-1"></i>
                                </button>
                                <button onclick="app.playGame('${game.id}')" class="mobile-play-btn glossy-btn text-white text-sm font-bold px-6 py-2 rounded-full hidden">
                                    <i class="fa-solid fa-play mr-2"></i> JOGAR
                                </button>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            },

            // --- UTILS ---

            showToast(message, color) {
                const toast = document.createElement('div');
                const bgColor = color === 'green' ? 'from-green-400 to-teal-400' : 
                               color === 'sky' ? 'from-sky-400 to-cyan-400' : 
                               color === 'orange' ? 'from-orange-400 to-red-500' : 'from-gray-400 to-gray-500';
                toast.className = `fixed bottom-5 right-5 bg-gradient-to-r ${bgColor} text-white px-6 py-3 rounded-xl shadow-xl z-[100] font-medium border border-white/30`;
                toast.style.boxShadow = '0 10px 40px rgba(0,100,150,0.3)';
                toast.innerHTML = message;
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(20px)';
                    toast.style.transition = 'all 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },

            openModal(id) {
                const el = document.getElementById(id);
                if(el) el.classList.remove('hidden');
                if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playPop();
            },

            closeModal(id) {
                if (id === 'play-modal') {
                    const iframe = document.getElementById('game-iframe');
                    if(iframe) iframe.src = '';
                }
                const el = document.getElementById(id);
                if(el) el.classList.add('hidden');
                if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playClose();
            },

            switchModal(from, to) {
                this.closeModal(from);
                setTimeout(() => this.openModal(to), 300);
            },

            toggleFullscreen() {
                const elem = document.getElementById('play-modal');
                if (!document.fullscreenElement) {
                    elem.requestFullscreen().catch(err => {
                        alert(`Erro ao entrar em tela cheia: ${err.message}`);
                    });
                } else {
                    document.exitFullscreen();
                }
            },
            
            goHome() {
                const search = document.getElementById('search-input');
                if(search) search.value = '';
                this.renderGames();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },

            // --- DEVICE SELECTION ---
            selectDevice(device) {
                localStorage.setItem('glshub-device', device);
                this.applyDeviceMode(device);
                
                if (window.SoundFX && window.SoundFX.audioContext) {
                    window.SoundFX.playSuccess();
                }
            },

            applyDeviceMode(device) {
                this.state.deviceMode = device;
                
                // Hide selection screen
                const selectionScreen = document.getElementById('device-selection');
                if (selectionScreen) {
                    selectionScreen.style.opacity = '0';
                    selectionScreen.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        selectionScreen.style.display = 'none';
                    }, 500);
                }
                
                // Apply mode class to body
                if (device === 'mobile') {
                    document.body.classList.add('mobile-mode');
                    document.body.classList.remove('pc-mode');
                } else {
                    document.body.classList.add('pc-mode');
                    document.body.classList.remove('mobile-mode');
                }
                
                // Update switch button text
                this.updateSwitchModeButton();
                
                // Re-render games with correct mode
                this.renderGames();
            },

            isMobileMode() {
                return this.state.deviceMode === 'mobile';
            },

            switchDeviceMode() {
                const newMode = this.state.deviceMode === 'mobile' ? 'pc' : 'mobile';
                localStorage.setItem('glshub-device', newMode);
                this.applyDeviceMode(newMode);
                
                if (window.SoundFX && window.SoundFX.audioContext) {
                    window.SoundFX.playClick();
                }
                
                this.showToast(newMode === 'mobile' ? 'üì± Modo Mobile ativado!' : 'üñ•Ô∏è Modo PC ativado!', 'sky');
            },

            updateSwitchModeButton() {
                const btn = document.getElementById('switch-mode-text');
                if (btn) {
                    btn.textContent = this.state.deviceMode === 'mobile' ? 'Trocar para PC' : 'Trocar para Mobile';
                }
            },

            // --- PROFILE SYSTEM ---

            async openProfile(uid) {
                if (!uid) return;
                
                try {
                    // Load profile from Firestore
                    const profileRef = doc(db, "profiles", uid);
                    const profileSnap = await getDoc(profileRef);
                    
                    let profile = {
                        displayName: 'Usu√°rio',
                        bio: '',
                        url: '',
                        banner: '',
                        avatar: ''
                    };
                    
                    if (profileSnap.exists()) {
                        profile = { ...profile, ...profileSnap.data() };
                    }
                    
                    // Check if viewing own profile
                    const isOwnProfile = this.state.currentUser && this.state.currentUser.uid === uid;
                    
                    // Get user's games count
                    const userGames = this.state.games.filter(g => g.uid === uid);
                    
                    // Update display
                    document.getElementById('profile-display-name').textContent = profile.displayName || 'Usu√°rio';
                    document.getElementById('profile-display-bio').textContent = profile.bio || 'Nenhuma bio definida.';
                    document.getElementById('profile-display-url').textContent = profile.url ? `glshub.com/${profile.url}` : '';
                    document.getElementById('profile-display-url').style.display = profile.url ? 'block' : 'none';
                    document.getElementById('profile-games-count').textContent = userGames.length;
                    
                    // Avatar
                    const avatarLetter = document.getElementById('profile-avatar-letter');
                    const avatarImg = document.getElementById('profile-avatar-img');
                    if (profile.avatar) {
                        avatarLetter.classList.add('hidden');
                        avatarImg.classList.remove('hidden');
                        avatarImg.src = profile.avatar;
                    } else {
                        avatarLetter.classList.remove('hidden');
                        avatarImg.classList.add('hidden');
                        avatarLetter.textContent = (profile.displayName || 'U').charAt(0).toUpperCase();
                    }
                    
                    // Banner
                    const bannerPreview = document.getElementById('profile-banner-preview');
                    if (profile.banner) {
                        bannerPreview.style.backgroundImage = `url(${profile.banner})`;
                    } else {
                        bannerPreview.style.backgroundImage = '';
                    }
                    
                    // Show edit button only for own profile
                    const editBtn = document.getElementById('profile-edit-btn');
                    if (isOwnProfile) {
                        editBtn.classList.remove('hidden');
                        // Pre-fill edit form
                        document.getElementById('profile-edit-name').value = profile.displayName || '';
                        document.getElementById('profile-edit-bio').value = profile.bio || '';
                        document.getElementById('profile-edit-url').value = profile.url || '';
                        document.getElementById('profile-edit-banner').value = profile.banner || '';
                        document.getElementById('profile-edit-avatar').value = profile.avatar || '';
                    } else {
                        editBtn.classList.add('hidden');
                    }
                    
                    // Store current profile uid for saving
                    this.state.viewingProfileUid = uid;
                    
                    // Reset to display mode
                    this.toggleProfileEdit(false);
                    
                    this.openModal('profile-modal');
                    
                } catch (error) {
                    console.error("Error loading profile:", error);
                    alert("Erro ao carregar perfil.");
                }
            },

            toggleProfileEdit(showEdit) {
                const displaySection = document.getElementById('profile-display');
                const editSection = document.getElementById('profile-edit');
                
                if (showEdit) {
                    displaySection.classList.add('hidden');
                    editSection.classList.remove('hidden');
                } else {
                    displaySection.classList.remove('hidden');
                    editSection.classList.add('hidden');
                }
            },

            async handleSaveProfile(e) {
                e.preventDefault();
                
                if (!this.state.currentUser) return;
                
                const displayName = document.getElementById('profile-edit-name').value.trim();
                const bio = document.getElementById('profile-edit-bio').value.trim();
                const url = document.getElementById('profile-edit-url').value.trim().toLowerCase().replace(/[^a-z0-9-]/g, '');
                const banner = document.getElementById('profile-edit-banner').value.trim();
                const avatar = document.getElementById('profile-edit-avatar').value.trim();
                
                if (!displayName) {
                    alert('Por favor, insira um nome de exibi√ß√£o.');
                    return;
                }
                
                try {
                    const profileRef = doc(db, "profiles", this.state.currentUser.uid);
                    await setDoc(profileRef, {
                        displayName,
                        bio,
                        url,
                        banner,
                        avatar,
                        updatedAt: Date.now()
                    }, { merge: true });
                    
                    // Update auth profile display name
                    await updateProfile(auth.currentUser, {
                        displayName: displayName
                    });
                    
                    // Update local state
                    this.state.currentUser.username = displayName;
                    
                    // Re-render nav
                    this.renderNav();
                    
                    // Refresh profile display
                    await this.openProfile(this.state.currentUser.uid);
                    
                    if (window.SoundFX && window.SoundFX.audioContext) window.SoundFX.playSuccess();
                    this.showToast('‚úÖ Perfil atualizado com sucesso!', 'green');
                    
                } catch (error) {
                    console.error("Error saving profile:", error);
                    alert("Erro ao salvar perfil.");
                }
            }
        };

        // Initialize when module loads
        window.app.init();

        // ===== SOUND EFFECTS SYSTEM =====
        const SoundFX = {
            audioContext: null,
            
            init() {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                this.addClickListeners();
            },

            // Som de clique suave estilo Windows 7
            playClick() {
                if (!this.audioContext) return;
                
                const ctx = this.audioContext;
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.setValueAtTime(600, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.1);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.15);
            },

            // Som de sucesso (para a√ß√µes positivas)
            playSuccess() {
                if (!this.audioContext) return;
                
                const ctx = this.audioContext;
                
                // Primeiro tom
                const osc1 = ctx.createOscillator();
                const gain1 = ctx.createGain();
                osc1.connect(gain1);
                gain1.connect(ctx.destination);
                osc1.frequency.setValueAtTime(523.25, ctx.currentTime); // C5
                osc1.type = 'sine';
                gain1.gain.setValueAtTime(0.2, ctx.currentTime);
                gain1.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                osc1.start(ctx.currentTime);
                osc1.stop(ctx.currentTime + 0.2);
                
                // Segundo tom (mais alto)
                const osc2 = ctx.createOscillator();
                const gain2 = ctx.createGain();
                osc2.connect(gain2);
                gain2.connect(ctx.destination);
                osc2.frequency.setValueAtTime(659.25, ctx.currentTime + 0.1); // E5
                osc2.type = 'sine';
                gain2.gain.setValueAtTime(0.01, ctx.currentTime);
                gain2.gain.setValueAtTime(0.25, ctx.currentTime + 0.1);
                gain2.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.35);
                osc2.start(ctx.currentTime + 0.1);
                osc2.stop(ctx.currentTime + 0.35);
            },

            // Som de hover suave
            playHover() {
                if (!this.audioContext) return;
                
                const ctx = this.audioContext;
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.setValueAtTime(800, ctx.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.08, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.08);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.08);
            },

            // Som de fechar/voltar
            playClose() {
                if (!this.audioContext) return;
                
                const ctx = this.audioContext;
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(250, ctx.currentTime + 0.12);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.12);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.12);
            },

            // Som de pop (para abrir modais)
            playPop() {
                if (!this.audioContext) return;
                
                const ctx = this.audioContext;
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.setValueAtTime(300, ctx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(600, ctx.currentTime + 0.08);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.25, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.15);
            },

            // Som de teclado mec√¢nico (estilo Cherry MX Blue)
            playKeyPress() {
                if (!this.audioContext) return;
                
                const ctx = this.audioContext;
                const now = ctx.currentTime;
                
                // Criar ru√≠do branco para o "click" mec√¢nico
                const bufferSize = ctx.sampleRate * 0.03; // 30ms
                const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const output = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
                
                const whiteNoise = ctx.createBufferSource();
                whiteNoise.buffer = noiseBuffer;
                
                // Filtro para dar o som "clicky" caracter√≠stico
                const filter = ctx.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.setValueAtTime(3000 + Math.random() * 1000, now);
                filter.Q.setValueAtTime(1.5, now);
                
                // Ganho com envelope r√°pido
                const gainNode = ctx.createGain();
                gainNode.gain.setValueAtTime(0.15 + Math.random() * 0.05, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.025);
                
                // Tom de "spring" do switch mec√¢nico
                const oscillator = ctx.createOscillator();
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(1800 + Math.random() * 400, now);
                oscillator.frequency.exponentialRampToValueAtTime(600, now + 0.015);
                
                const oscGain = ctx.createGain();
                oscGain.gain.setValueAtTime(0.03, now);
                oscGain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);
                
                // Conectar noise
                whiteNoise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                // Conectar oscillator
                oscillator.connect(oscGain);
                oscGain.connect(ctx.destination);
                
                // Tocar
                whiteNoise.start(now);
                whiteNoise.stop(now + 0.03);
                oscillator.start(now);
                oscillator.stop(now + 0.02);
            },

            // Som de soltar a tecla (key up)
            playKeyRelease() {
                if (!this.audioContext) return;
                
                const ctx = this.audioContext;
                const now = ctx.currentTime;
                
                // Som mais suave e curto para o release
                const bufferSize = ctx.sampleRate * 0.015;
                const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const output = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
                
                const whiteNoise = ctx.createBufferSource();
                whiteNoise.buffer = noiseBuffer;
                
                const filter = ctx.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.setValueAtTime(2000, now);
                
                const gainNode = ctx.createGain();
                gainNode.gain.setValueAtTime(0.06, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.015);
                
                whiteNoise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                whiteNoise.start(now);
                whiteNoise.stop(now + 0.015);
            },

            addClickListeners() {
                // Delega√ß√£o de eventos para cliques
                document.addEventListener('click', (e) => {
                    const target = e.target.closest('button, a, [onclick], .clickable, .game-card, .glossy-btn, .glossy-btn-green');
                    if (target) {
                        this.playClick();
                    }
                });

                // Sons espec√≠ficos para inputs ao focar
                document.addEventListener('focusin', (e) => {
                    if (e.target.matches('input, textarea')) {
                        this.playHover();
                    }
                });

                // Som de teclado mec√¢nico ao digitar
                document.addEventListener('keydown', (e) => {
                    if (e.target.matches('input, textarea')) {
                        // Ignorar teclas de controle que n√£o "digitam"
                        if (e.key === 'Shift' || e.key === 'Control' || e.key === 'Alt' || 
                            e.key === 'Meta' || e.key === 'CapsLock' || e.key === 'Tab' ||
                            e.key === 'Escape' || e.key === 'ArrowUp' || e.key === 'ArrowDown' ||
                            e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                            return;
                        }
                        this.playKeyPress();
                    }
                });

                // Som de soltar a tecla
                document.addEventListener('keyup', (e) => {
                    if (e.target.matches('input, textarea')) {
                        if (e.key === 'Shift' || e.key === 'Control' || e.key === 'Alt' || 
                            e.key === 'Meta' || e.key === 'CapsLock' || e.key === 'Tab' ||
                            e.key === 'Escape' || e.key === 'ArrowUp' || e.key === 'ArrowDown' ||
                            e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                            return;
                        }
                        this.playKeyRelease();
                    }
                });
            }
        };

        // Inicializar sons ap√≥s primeira intera√ß√£o (necess√°rio para Web Audio API)
        document.addEventListener('click', function initSound() {
            SoundFX.init();
            document.removeEventListener('click', initSound);
        }, { once: true });
    </script>
</body>
</html>
